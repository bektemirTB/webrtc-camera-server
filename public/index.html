<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>ÐšÐ°Ð¼ÐµÑ€Ð° (WebRTC)</title>
</head>
<body>
  <h2>ðŸ“· ÐšÐ°Ð¼ÐµÑ€Ð° Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°</h2>
  <video id="video" autoplay playsinline></video>
  <script>
    const socket = io("https://webrtc-camera-server.onrender.com");

    const video = document.getElementById("video");

    navigator.mediaDevices.getUserMedia({ video: true, audio: false })
      .then(stream => {
        video.srcObject = stream;
        const pc = new RTCPeerConnection();
        stream.getTracks().forEach(track => pc.addTrack(track, stream));

        pc.onicecandidate = event => {
          if (event.candidate) {
            socket.send(JSON.stringify({ type: "candidate", candidate: event.candidate }));
          }
        };

        pc.createOffer().then(offer => {
          pc.setLocalDescription(offer);
          socket.send(JSON.stringify({ type: "offer", offer }));
        });

        socket.onmessage = async event => {
          const data = JSON.parse(event.data);
          if (data.type === "answer") {
            await pc.setRemoteDescription(new RTCSessionDescription(data.answer));
          }
        };
      })
      .catch(console.error);
  </script>
</body>
</html>
