<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–º–µ—Ä—ã</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
  <h1>–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–º–µ—Ä—ã</h1>
  <video id="remoteVideo" autoplay playsinline></video>

  <script>
const socket = io("https://webrtc-camera-server.onrender.com");
const roomId = "room1";
const video = document.getElementById("remoteVideo");
let peer;

socket.emit("join-room", { roomId, role: "viewer" });

socket.on("offer", async ({ offer, target }) => {
  console.log("üì° –ü–æ–ª—É—á–µ–Ω offer –æ—Ç –∫–∞–º–µ—Ä—ã");

  peer = new RTCPeerConnection();

  peer.ontrack = e => {
    console.log("üé• –í–∏–¥–µ–æ –ø–æ–ª—É—á–µ–Ω–æ");
    video.srcObject = e.streams[0];
  };

  peer.onicecandidate = e => {
    if (e.candidate) {
      socket.emit("ice-candidate", { candidate: e.candidate, target });
    }
  };

  await peer.setRemoteDescription(new RTCSessionDescription(offer));
  const answer = await peer.createAnswer();
  await peer.setLocalDescription(answer);
  socket.emit("answer", { answer, target });
});

socket.on("camera-disconnected", () => {
  console.log("‚ùå –ö–∞–º–µ—Ä–∞ –æ—Ç–∫–ª—é—á–∏–ª–∞—Å—å");
  video.srcObject = null;
});
</script>

</body>
</html>
